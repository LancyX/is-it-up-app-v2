services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - HA_BASE_URL=${HA_BASE_URL:-http://host.docker.internal:8123}
      - HA_TOKEN=${HA_TOKEN}
      - GRID_ENTITY_ID=${GRID_ENTITY_ID:-binary_sensor.grid_power}
    extra_hosts:
      - "host.docker.internal:host-gateway"

  frontend:
    build:
      context: ./frontend
      args:
        VITE_CONTACT_EMAIL: ${VITE_CONTACT_EMAIL:-}
        VITE_GITHUB_REPO_URL: ${VITE_GITHUB_REPO_URL:-}
        VITE_BASE_PATH: ${VITE_BASE_PATH:-/}
        VITE_API_BASE: ${VITE_API_BASE:-/api}
    ports:
      - "3000:80"
    depends_on:
      - backend
